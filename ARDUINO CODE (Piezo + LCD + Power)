#include <Wire.h>
#include <LiquidCrystal_I2C.h>

#define PIEZO_PIN A0
#define LED_PIN 8

LiquidCrystal_I2C lcd(0x27, 16, 2);

int adcValue = 0;
float voltage = 0.0;
int steps = 0;

const int threshold = 70;
const float refVoltage = 5.0;

unsigned long lastStepTime = 0;

void setup() {
  pinMode(LED_PIN, OUTPUT);
  lcd.init();
  lcd.backlight();

  Serial.begin(9600);

  lcd.setCursor(0,0);
  lcd.print("Piezo Footstep");
  lcd.setCursor(0,1);
  lcd.print("System Ready");
  delay(2000);
  lcd.clear();
}

void loop() {

  adcValue = analogRead(PIEZO_PIN);
  voltage = (adcValue * refVoltage) / 1023.0;

  if (adcValue > threshold && millis() - lastStepTime > 300) {
    steps++;
    digitalWrite(LED_PIN, HIGH);
    delay(100);
    digitalWrite(LED_PIN, LOW);
    lastStepTime = millis();
  }

  lcd.setCursor(0,0);
  lcd.print("V: ");
  lcd.print(voltage, 2);
  lcd.print("V     ");

  lcd.setCursor(0,1);
  lcd.print("Steps: ");
  lcd.print(steps);
  lcd.print("    ");

  Serial.print("ADC: ");
  Serial.print(adcValue);
  Serial.print(" Voltage: ");
  Serial.println(voltage);

  delay(100);
}
